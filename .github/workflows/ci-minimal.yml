name: CI Minimal

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - name: Check README exists
        run: |
          if [ -f README.md ]; then
            echo "README.md found ($(wc -w < README.md) words)"
          elif [ -f profile/README.md ]; then
            echo "profile/README.md found ($(wc -w < profile/README.md) words)"
          else
            echo "::error::No README.md found"
            exit 1
          fi

      - name: Validate seed.yaml
        run: |
          if [ -f seed.yaml ]; then
            python3 -c "import yaml; yaml.safe_load(open('seed.yaml'))" && echo "seed.yaml is valid YAML" || { echo "::error::seed.yaml is invalid YAML"; exit 1; }
          else
            echo "No seed.yaml (optional for this repo type)"
          fi

      - name: Secret scan
        run: |
          FOUND=0
          for pattern in 'sk-[a-zA-Z0-9]{20,}' 'ghp_[a-zA-Z0-9]{36}' 'AKIA[A-Z0-9]{16}'; do
            if git grep -lP "$pattern" -- ':!.github' 2>/dev/null; then
              echo "::error::Potential secret pattern found: $pattern"
              FOUND=1
            fi
          done
          if [ "$FOUND" -eq 1 ]; then
            exit 1
          fi
          echo "No secret patterns detected"
